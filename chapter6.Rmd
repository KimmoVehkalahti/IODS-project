# Week 6: Analysis of longitudinal data

After working hard with multivariate, mostly exploratory, even heuristic techniques that are common in data science, the last topic of IODS course will take us back in the task of building statistical models.

The new challenge is that the data will include two types of dependencies simultaneously: In addition to the correlated variables that we have faced with all models and methods so far, the observations of the data will also be correlated with each other.

**Lets start this weeks session**

Usually, we can assume that the observations are not correlated - instead, they are assumed to be independent of each other. However, in **longitudinal settings** this assumption seldom holds, because we have multiple observations or measurements of the same individuals. The concept of repeated measures highlights this phenomenon that is actually quite typical in many applications. Both types of dependencies (variables and observations) must be taken into account; otherwise the models will be biased.

```{r echo=FALSE, out.width= "50%"}
knitr::include_graphics("long2.jpg", error = FALSE)
```

To analyze this kind of data sets, we will focus on a single class of methods, called **linear mixed effects models** that can cope quite nicely with the setting described above.

Before we consider two examples of mixed models, namely the random intercept model and the random intercept and slope model, we will learn how to wrangle longitudinal data in wide form and long form, take a look at some graphical displays of longitudinal data, and try a simple summary measure approach that may sometimes provide a useful first step in these challenges. In passing, we “violently” apply the usual “fixed” models (although we know that they are not the right choice here) in order to compare the results and see the consequences of making invalid assumptions.

**Load the packages first !! **

## 6.1 Packages for Week 6 !!

```{r}
#load required packages
library(ggplot2)
library(corrplot)
library(tidyverse)
library(GGally)
library(dplyr)
library(stringr)
library(psych) 
library(FactoMineR)
library(lme4)
```

That's a lot of packages !!!

```{r echo=FALSE, out.width= "40%"}
knitr::include_graphics("long1.jpg", error = FALSE)
```

## Analysis of RATS data 

Lets implement the analyses of Chapter 8 of MABS, using the R codes of Exercise Set 6: Meet and Repeat: PART I but using the RATS data (from Chapter 9 and Meet and Repeat: PART II) as instructed in the Moodle. 

### 6.2 Loading the data 

```{r}
# read long format data of rats
RATSL <- read.csv('RATSL.csv')

# glimpse and dimensions
head(RATSL);dim(RATSL)
str(RATSL)
summary(RATSL)
```
The data set contains observation from 6 rats and 11 observation of change in weight by Time. They are divided into 3 groups based on treatment. Weight in this case is the outcome variable in this longitudinal study. The idea is to analyse the weight difference in three group over time. 

### 6.3 Plotting the data

```{r}

# Lets convert categorical data to factors first 
## WE have ID and Group (Just like wrangling exercise)
RATSL$ID <- factor(RATSL$ID)
RATSL$Group <- factor(RATSL$Group)

# Draw the plot ##We plot the Weights of each rat by time and groups
# Rats are divided into three groups
ggplot(RATSL, aes(x = Time, y = Weight, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ Group, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(RATSL$Weight), max(RATSL$Weight)))
```
From the plot we can see that Group 1 has the most rats with lowest weight even at starting point (time of recruitment). Group 2 the most incremental weight outcome compare to baseline but has only 4 rats. Group 3 has also 4 rats with almost same weight range as Group 2, however the weight doesn't seem to increase significantly as group 2. 

### 6.4 Standardizing for tracking

Higher baseline values means higher values throughout the study.This phenomenon is generally referred to as tracking.

The tracking phenomenon can be seen more clearly in a plot of the standardized values of each
observation, i.e.,

$$standardised(x) = \frac{x - mean(x)}{ sd(x)}$$

```{r}

# Standardize the variable weight by groups
RATSL <- RATSL %>%
  group_by(Time) %>%
  mutate(Weight_std= (scale(Weight))) %>%
  ungroup()

# Glimpse the data
glimpse(RATSL)

# Plot again with the standardized weight in RATSL 
ggplot(RATSL, aes(x = Time, y = Weight_std, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ Group, labeller = label_both) +
  theme(legend.position = "none")
  scale_y_continuous(name = "standardized Weignt")
```
After the standardization, the weight difference looks similar. 

### 6.5 Summary graphs

With large numbers of observations, graphical displays of individual response profiles are of little use and investigators then commonly produce graphs showing average (mean) profiles for each treatment group along with some indication of the variation of the observations at each time point, in this case the standard error of mean

$$se = \frac{sd(x)}{\sqrt{n}}$$
```{r}
# Summary data with mean and standard error of RATSl by treatment and week 
RATSL <- RATSL %>%
  group_by(Group, Time) %>%
  summarise(mean = mean(Weight), se = (sd(Weight)/sqrt(length(Weight))) ) %>% #using formula above;
  ungroup()

# Glimpse the data
glimpse(RATSL)

# Plot the mean profiles
ggplot(RATSL, aes(x = Time, y = mean,  linetype = Group, shape = Group)) +
  geom_line() +
  scale_linetype_manual(values = c(1,2,3)) +
  geom_point(size=3) +
  scale_shape_manual(values = c(1,2,3)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se, linetype="1"), width=0.3) +
  theme(legend.position = c(0.8,0.8)) +
  scale_y_continuous(name = "mean(Weight) +/- se(Weight)")
```


## Analysis of BPRS data 

Lets implement Implement the analyses of Chapter 9 of MABS, using the R codes of Exercise Set 6: Meet and Repeat: PART II, but using the BPRS data (from Chapter 8 and Meet and Repeat: PART I) as instructed in the Moodle. 

### 6.11 Loading the data 

```{r}

```


### 6.3 Individuals on the plot













**DONE AND DUSTED** $\large \surd$ !!! 

```{r echo=FALSE, out.width= "20%"}
knitr::include_graphics("santa.jpg", error = FALSE)
```


**Well not really !!** There is so much more to learn. This course was however a great "push"
I have truly enjoyed the exercise sessions, the course material and the review exercises. I have learned so much and I am looking forward to learning more !! 

**Merry Christmas and a Happy New Year Everyone !!**

```{r echo=FALSE, out.width= "100%"}
knitr::include_graphics("newyear.jpg", error = FALSE)
```





