---
title: "IODS"
subtitle: "Assignment 2"

author: "Rong Guang"
date: "09/11/2022"

output: 
  html_document:
    fig_caption: yes
    theme: flatly
    highlight: haddock
    toc: true
    toc_depth: 3
    toc_float: true
    number_section: false
---


# Insert chapter 2 title here

*Describe the work you have done this week and summarize your learning.*

- Describe your work and results clearly. 
- Assume the reader has an introductory course level understanding of writing and reading R code as well as statistical methods.
- Assume the reader has no previous knowledge of your data or the more advanced methods you are using.

```{r}
date()
```


# 1 Preparing

## 1.1 read the data set

```{r}
learn <- read_csv(file = "data/learning2014.csv")
```

## 1.2 Code categorical data

```{r}
learn <- learn %>% 
  mutate(gender = gender %>%
           factor() %>% 
           fct_recode("Female" = "F",
                      "Male" = "M"))
```

## 1.3 explore the data set

```{r}
#explore dimensions
dim(learn)
```


```{r}
#explore structure
str(learn)
```


```{r}
library(finalfit)
library(DT)
ff_glimpse(learn)$Continuous %>% datatable()
```


```{r}
ff_glimpse(learn)$Categorical %>% datatable()
```

## 1.4 visualize the data set

```{r, fig.width= 10, fig.height=6}
library(GGally)
library(ggplot2)
# create an plot matrix with ggpairs()
my_fn <- function(data, mapping, method="loess", ...){
      p <- ggplot(data = data, mapping = mapping) + 
      geom_point(size = 0.3, color = "coral") + 
      geom_smooth(method=method, ...)
      p
    }
ggpairs(learn, 
        lower= list(combo = wrap("facethist", bins = 20),
                    continuous = my_fn)
        )

```


```{r}

p1 <- learn  %>% ggplot(aes (x = age, y = points)) +
  geom_point()+
  geom_smooth(method = "loess")

learn %>% ggplot(aes(x = age))+
  geom_boxplot()+
  coord_flip()

fit_age <- lm(points ~ age, data = learn)
summary(fit_age)
cooksd <- cooks.distance(fit_age)
cooksd %>% broom::tidy()
plot(cooksd, pch="*", cex=2, main="Influential Obs by Cooks distance") +
abline(h = 4*mean(cooksd), col="red")+
text(x=1:length(cooksd)+3.5, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=T),names(cooksd),""), col="red")

learn$fit_age_cooksd <- cooksd
learn1 <- learn %>% filter(fit_age_cooksd<4*mean(fit_age_cooksd))

p2 <- learn1  %>% ggplot(aes (x = age, y = points)) +
  geom_point()+
  geom_smooth(method = "loess")
library(patchwork)
p1
learn <- learn %>% mutate(age.factor = age %>% 
                            cut(breaks =c(0,19,22,25,27,34,100)))
learn %>% count(age.factor)
learn %>% 
  filter(age.factor == "(19,22]") %>% 
  ggplot(aes (x = age, y = points))+
  geom_point()+
  geom_smooth(method = "loess")

fit_age1 <- learn %>% 
  filter (age.factor == "(19,22]")%>% 
  lm(points ~ age, data = .)
summary(fit_age1)

p1
```


```{r}
USHSv2 <- USHSv2 %>% mutate(BMI.factor = BMI %>%  #turn BMI into factor and add labels(underweight:<18.5,                                                   #normal weight: ~25, overweight: ~30; obese: >30)
                    cut(breaks=c(1,18.5,25,30,100), include.lowest = T) %>% 
                    fct_recode("Underweight" = "[1,18.5]",
                               "Normal weight" = "(18.5,25]",
                               "Overweight" = "(25,30]",
                               "Obese" = "(30,100]") %>% 
                    ff_label("BMI ranges"))
```


```{r}
```


```{r}

```

Here we go again...

a test to see if it works